Bootstrap: docker
From: ubuntu:bionic

%labels
    name np-medaka
    version v0.1.0
    author esteinig

%post

    MEDAKA_VERSION=0.11.2
    MINIMAP2_VERSION=2.17
    SAMTOOLS_VERSION=1.7
    HTSLIB_VERSION=1.9

    mkdir /software && cd /software

    apt-get update && apt-get install -y \
       git \
       bzip2 \
       gcc \
       git-lfs \
       g++ \
       cmake \
       zlib1g-dev \
       libbz2-dev  \
       liblzma-dev \
       libffi-dev \
       libncurses5-dev \
       libcurl4-gnutls-dev \
       libssl-dev \
       curl \
       make \
       tabix \
       wget \
       python3-all-dev \
       python3-pip \
       python-virtualenv

    git lfs install

    wget https://github.com/samtools/htslib/releases/download/${HTSLIB_VERSION}/htslib-${HTSLIB_VERSION}.tar.bz2
    tar -vxjf htslib-${HTSLIB_VERSION}.tar.bz2
    cd htslib-${HTSLIB_VERSION}
    make

    cd /software

    wget https://github.com/samtools/samtools/releases/download/${SAMTOOLS_VERSION}/samtools-${SAMTOOLS_VERSION}.tar.bz2
    tar -vxjf samtools-${SAMTOOLS_VERSION}.tar.bz2
    cd samtools-${SAMTOOLS_VERSION}
    make

    cd /software

    curl -L https://github.com/lh3/minimap2/releases/download/v${MINIMAP2_VERSION}/minimap2-${MINIMAP2_VERSION}_x64-linux.tar.bz2 | tar -jxvf -
    ln -s /software/minimap2-${MINIMAP2_VERSION}_x64-linux/minimap2 /usr/bin

    cd /software

    git clone https://github.com/nanoporetech/medaka.git
    cd medaka && make install

    apt-get clean



    
%environment
    export PATH=/software/medaka/venv/bin:$PATH